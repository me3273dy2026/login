<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Topic Allocation | ME3273</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.card{
  background:#fff;
  width:100%;
  max-width:520px;
  margin:24px 12px;
  padding:24px;
  border-radius:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);
}
h1{font-size:16px;text-align:center;color:#203a43;margin:0;}
h2{font-size:14px;text-align:center;color:#555;margin:6px 0 14px;}
.infoBox{
  background:#f5f7fa;
  border-radius:12px;
  padding:14px;
  margin-top:16px;
  font-size:14px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:30px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  margin-top:16px;
}
.btn-logout{
  background:#c0392b;
  color:#fff;
}
button:disabled{
  background:#999;
  cursor:not-allowed;
}
.footer{
  margin:12px 0 20px;
  text-align:center;
  font-size:13px;
  color:#e0e0e0;
}
</style>
</head>

<body>

<div class="card">

  <h1 id="welcome">Welcome</h1>
  <h2>Group Discussion & Seminar (ME3273)</h2>

  <div id="resultBox" class="infoBox" style="display:none"></div>
  <div id="seminarBox" class="infoBox" style="display:none"></div>

  <button id="logoutBtn" class="btn-logout" onclick="logout()">Logout</button>

</div>

<div class="footer">
  <div>Developed by Rajesh Akula</div>
  <div>© 2026 · IIEST Shibpur</div>
</div>

<script>
const BACKEND =
"https://script.google.com/macros/s/AKfycbxAOPaDRPGJKA4reATcVo9m17USl7llQ7XD-0WnOC0Fvh04rzPuGAps6_L5BN-qp-Yg2Q/exec";

const token = new URLSearchParams(location.search).get("token");

/* ---------- LOAD DATA ---------- */
loadAll();

function loadAll(){

  // Dashboard → group details
  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({ action:"dashboard", token })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status !== "ASSIGNED"){
      resultBox.innerHTML =
        "<b>No group assigned.</b>";
      resultBox.style.display = "block";
      return;
    }

    welcome.innerText =
      `Welcome ${res.name} (${res.roll})`;

    let html =
      `<b>Assigned Group Discussion Topic:</b><br>
       ${res.project} – ${res.projectName}<br><br>
       <b>Group Members:</b><br>`;

    res.team.forEach((s,i)=>{
      html += `${i+1}. ${s.name} (${s.roll})<br>`;
    });

    resultBox.innerHTML = html;
    resultBox.style.display = "block";
  });

  // Seminar topic (read-only)
  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({ action:"getSeminarTopic", token })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.topic){
      seminarBox.innerHTML =
        `<b>Submitted Seminar Topic:</b><br>
         <span style="color:#1b5e20">
         "${res.topic}"
         </span>`;
      seminarBox.style.display = "block";
    }
  });
}

/* ---------- LOGOUT ---------- */
function logout(){
  logoutBtn.disabled = true;

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({ action:"logout", token })
  })
  .finally(()=>{
    location.href="login.html";
  });
}
</script>

</body>
</html>
