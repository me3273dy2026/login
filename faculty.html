<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Faculty Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Segoe UI;background:#203a43;margin:0}
.card{max-width:1100px;margin:20px auto;background:#fff;
padding:24px;border-radius:14px}
button{width:100%;padding:12px;margin-top:10px;
border:none;border-radius:24px;font-weight:600}
.btn{background:#203a43;color:#fff}
.btn-red{background:#c0392b;color:#fff}
.box{background:#f4f7fb;padding:16px;margin-top:14px;border-radius:12px}
.sub{background:#fff;padding:10px;border-radius:8px;margin-top:8px}
input,select{width:100%;padding:10px;border-radius:8px}
.msg{margin-top:10px;font-weight:700;color:#c0392b}
</style>
</head>

<body>
<div class="card">
<h2>Faculty Dashboard</h2>

<div id="home">
  <button class="btn" onclick="openAlloc()">Allocate</button>
  <button class="btn" onclick="openEval()">Evaluate</button>
  <button class="btn-red" onclick="logout()">Logout</button>
</div>

<div id="alloc" style="display:none">

<div class="box">
  <b>Date</b>
  <input type="date" id="date" onchange="onDate()">
</div>

<div class="box">
  <b>Group Discussion</b>
  <select id="gd"></select>
  <button class="btn" onclick="run('gd')">Save GD</button>
  <div id="gdList" class="sub"></div>
</div>

<div class="box">
  <b>Seminar</b>
  <div id="semList"></div>
  <button class="btn" onclick="run('sem')">Save Seminar</button>
</div>

<div class="box">
  <b>Personal Interview</b>
  <div id="piList"></div>
  <button class="btn" onclick="run('pi')">Save PI</button>
</div>

<div id="msg" class="msg"></div>
<button class="btn-red" onclick="back()">Close</button>
</div>

<div id="eval" style="display:none">
<iframe src="faculty_evaluation.html"
style="width:100%;height:700px;border:none"></iframe>
<button class="btn-red" onclick="back()">Close</button>
</div>

</div>

<script>
const BACKEND="https://script.google.com/macros/s/AKfycbyhesv5WFOs8MTKfh0SGoUjEbCqF4ZeKkALqrvhNu_iJAwwVF7o409PP5XLQ_1pgYXFHw/exec";

function disable(v,msg){
  document.querySelectorAll("button").forEach(b=>b.disabled=v);
  document.getElementById("msg").innerText=msg||"";
}

function openAlloc(){home.style.display="none";alloc.style.display="block"}
function openEval(){home.style.display="none";eval.style.display="block"}
function back(){alloc.style.display=eval.style.display="none";home.style.display="block"}

function onDate(){
  loadGD();
  loadAlloc();
}

function loadGD(){
  gd.innerHTML="<option value=''>Select GD Topic</option>";
  fetch(BACKEND,{method:"POST",
    body:new URLSearchParams({action:"getAvailableGDTopics",date:date.value})
  }).then(r=>r.json()).then(j=>{
    j.topics.forEach(t=>{
      gd.innerHTML+=`<option>${t}</option>`;
    });
  });
}

function loadAlloc(){
  fetch(BACKEND,{method:"POST",
    body:new URLSearchParams({action:"getAllocationsByDate",date:date.value})
  }).then(r=>r.json()).then(j=>{
    const g={GD:[],SEMINAR:[],PI:[]};
    j.allocations.forEach(a=>g[a.category].push(a));
    gdList.innerHTML=g.GD.map(x=>`${x.name} (${x.topic})`).join("<br>");
  });
}

function run(t){
  disable(true,"Updatingâ€¦ please wait");
  if(t==="gd"){
    fetch(BACKEND,{method:"POST",
      body:new URLSearchParams({action:"saveGDAllocation",date:date.value,topic:gd.value})
    }).then(()=>{disable(false);onDate()});
  }
}

function logout(){location.href="login.html";}
</script>
</body>
</html>
