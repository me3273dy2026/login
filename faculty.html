<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faculty Dashboard | ME3273</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  min-height:100vh;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:flex-start;
}

/* CARD */
.card{
  background:#fff;
  width:100%;
  max-width:520px;
  margin:24px 12px;
  padding:32px 30px;
  border-radius:14px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);
  animation:fadeIn .6s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}

/* HEADINGS */
h1{
  text-align:center;
  color:#e67e22;
  font-size:20px;
  margin-bottom:6px;
}
h2{
  text-align:center;
  color:#555;
  font-size:15px;
  margin-bottom:22px;
}

/* FORM */
label{
  font-weight:600;
  margin-top:14px;
  display:block;
}

select, textarea{
  width:100%;
  padding:10px 12px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:15px;
}

textarea{
  resize:vertical;
  min-height:90px;
}

/* BUTTON */
button{
  margin-top:26px;
  width:100%;
  padding:12px;
  background:linear-gradient(135deg,#f39c12,#e67e22);
  color:#fff;
  border:none;
  font-size:16px;
  font-weight:600;
  border-radius:30px;
  cursor:pointer;
}

button:disabled{
  background:#999;
  cursor:not-allowed;
}

/* FOOTER */
.footer{
  margin-top:26px;
  text-align:center;
  font-size:13px;
  color:#5f6f78;
  font-weight:600;
}
.footer div{
  font-size:12px;
  color:#7a8a93;
}
</style>
</head>

<body>

<div class="card">
  <h1>Faculty Dashboard</h1>
  <h2>Performance Evaluation (ME3273)</h2>

  <label>Select Student</label>
  <select id="studentSelect">
    <option value="">Loading students…</option>
  </select>

  <label>Evaluation Type</label>
  <select id="typeSelect">
    <option value="GD">Group Discussion</option>
    <option value="SEMINAR">Seminar</option>
    <option value="PI">Personal Interview</option>
  </select>

  <label>Positives</label>
  <textarea id="positives" placeholder="Strengths, good points, observations"></textarea>

  <label>Points to Improve</label>
  <textarea id="improvements" placeholder="Areas where student can improve"></textarea>

  <button id="saveBtn" onclick="savePerformance()">Save Performance</button>

  <div class="footer">
    Developed by Dr. Rajesh Akula
    <div>© 2026 · IIEST Shibpur</div>
  </div>
</div>

<script>
const BACKEND =
"https://script.google.com/macros/s/AKfycbxDu7ERgsjSTLgNbB_BOvPsnHhTymheEC3Y-skFgKFfrYRMos1ZkkDyYDDGzCBWAmbU3g/exec";

/* Load students */
fetch(BACKEND + "?action=getAllStudents")
  .then(r=>r.json())
  .then(res=>{
    studentSelect.innerHTML = `<option value="">Select Student</option>`;
    res.students.forEach(s=>{
      studentSelect.innerHTML +=
        `<option value="${s.roll}">
          ${s.roll} – ${s.name}
         </option>`;
    });
  });

studentSelect.onchange = checkExisting;
typeSelect.onchange = checkExisting;

function checkExisting(){
  positives.value = "";
  improvements.value = "";

  if(!studentSelect.value) return;

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"getLatestPerformance",
      roll: studentSelect.value,
      type: typeSelect.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="FOUND"){
      positives.value = res.positives;
      improvements.value = res.improvements;
      saveBtn.innerText = "Update Performance";
    }else{
      saveBtn.innerText = "Save Performance";
    }
  });
}

function savePerformance(){
  if(!studentSelect.value){
    alert("Please select a student");
    return;
  }

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"savePerformance",
      roll: studentSelect.value,
      type: typeSelect.value,
      positives: positives.value,
      improvements: improvements.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="SAVED"){
      alert("Performance saved successfully");
      saveBtn.innerText = "Update Performance";
    }else{
      alert("Error saving performance");
    }
  });
}
</script>

</body>
</html>
