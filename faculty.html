<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faculty Dashboard | ME3273</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
}
.card{
  background:#fff;
  width:100%;
  max-width:600px;
  margin:24px 12px;
  padding:24px;
  border-radius:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);
}
h1{
  font-size:18px;
  text-align:center;
  color:#203a43;
}
select, textarea, button{
  width:100%;
  margin-top:12px;
  padding:12px;
  font-size:14px;
  border-radius:10px;
  border:1px solid #ccc;
}
textarea{ min-height:90px; }
button{
  background:#203a43;
  color:#fff;
  font-weight:600;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="card">
  <h1>Faculty Performance Entry</h1>

  <select id="studentSelect">
    <option value="">Loading students…</option>
  </select>

  <select id="typeSelect">
    <option value="GD">Group Discussion</option>
    <option value="SEMINAR">Seminar</option>
    <option value="PI">Personal Interview</option>
  </select>

  <textarea id="positives" placeholder="Positives"></textarea>
  <textarea id="improvements" placeholder="Points to improve"></textarea>

  <button id="saveBtn" onclick="savePerformance()">Save Performance</button>
</div>

<script>
const BACKEND =
"https://script.google.com/macros/s/AKfycbxDu7ERgsjSTLgNbB_BOvPsnHhTymheEC3Y-skFgKFfrYRMos1ZkkDyYDDGzCBWAmbU3g/exec";

/* Load students */
fetch(BACKEND + "?action=getAllStudents")
  .then(r=>r.json())
  .then(res=>{
    studentSelect.innerHTML = `<option value="">Select Student</option>`;
    res.students.forEach(s=>{
      studentSelect.innerHTML +=
        `<option value="${s.roll}">
          ${s.roll} – ${s.name}
         </option>`;
    });
  });

studentSelect.onchange = checkExisting;
typeSelect.onchange = checkExisting;

function checkExisting(){
  positives.value = "";
  improvements.value = "";

  if(!studentSelect.value) return;

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"getLatestPerformance",
      roll: studentSelect.value,
      type: typeSelect.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="FOUND"){
      positives.value = res.positives;
      improvements.value = res.improvements;
      saveBtn.innerText = "Update Performance";
    }else{
      saveBtn.innerText = "Save Performance";
    }
  });
}

function savePerformance(){
  if(!studentSelect.value){
    alert("Select a student");
    return;
  }

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"savePerformance",
      roll: studentSelect.value,
      type: typeSelect.value,
      positives: positives.value,
      improvements: improvements.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="SAVED"){
      alert("Performance saved");
      saveBtn.innerText = "Update Performance";
    }else{
      alert("Error saving data");
    }
  });
}
</script>

</body>
</html>
