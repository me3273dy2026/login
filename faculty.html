<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faculty Dashboard | ME3273</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg1:#0f2027;
  --bg2:#203a43;
  --bg3:#2c5364;
  --primary:#203a43;
  --accent:#1abc9c;
  --danger:#c0392b;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Segoe UI",Arial,sans-serif;
  min-height:100vh;
  background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
  display:flex;
  justify-content:center;
  padding:28px 12px 100px;
}

.card{
  background:#fff;
  width:100%;
  max-width:700px;
  border-radius:20px;
  padding:28px;
  box-shadow:0 20px 50px rgba(0,0,0,.28);
  animation:fadeIn .6s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

.header{text-align:center;margin-bottom:18px}
.header h1{margin:0;color:var(--primary);font-size:22px}
.header h2{margin:4px 0 0;color:#666;font-size:14px}

button{
  width:100%;
  padding:14px;
  margin-top:14px;
  border:none;
  border-radius:30px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}

.btn-primary{background:linear-gradient(135deg,#2c5364,#203a43);color:#fff}
.btn-secondary{background:linear-gradient(135deg,#1abc9c,#16a085);color:#fff}
.btn-logout{background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff}

.section{
  margin-top:18px;
  border-radius:16px;
  border:1px solid #e0e0e0;
  overflow:hidden;
}

.section-header{
  background:#fafafa;
  padding:14px;
  font-weight:700;
  cursor:pointer;
}

.section-body{
  padding:16px;
  display:none;
}

.section.open .section-body{display:block}

label{font-weight:600;display:block;margin-top:12px}
input,select{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

.list{
  margin-top:10px;
  border:1px solid #ddd;
  border-radius:10px;
  padding:10px;
  max-height:220px;
  overflow:auto;
}

.list label{
  display:flex;
  justify-content:space-between;
  font-weight:500;
  padding:6px 0;
}

.notice{
  margin-top:12px;
  background:#f5f7fa;
  padding:12px;
  border-radius:12px;
  font-weight:600;
}

footer{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#0f2027;
  color:#cfd8dc;
  text-align:center;
  padding:10px;
  font-size:13px;
}

footer div{font-size:12px;color:#90a4ae}
</style>
</head>

<body>

<div class="card">

  <div class="header">
    <h1>Faculty Dashboard</h1>
    <h2>ME3273 · Seminar · GD · PI</h2>
  </div>

  <!-- ALLOCATION -->
  <div class="section">
    <div class="section-header" onclick="toggle(this)">
      Student Allocation
    </div>
    <div class="section-body">

      <label>Date</label>
      <input type="date" id="allocDate">

      <label>Category</label>
      <select id="allocCategory" onchange="loadAllocationList()">
        <option value="">-- Select --</option>
        <option value="GD">Group Discussion</option>
        <option value="SEMINAR">Seminar</option>
        <option value="PI">Personal Interview</option>
      </select>

      <div id="allocList" class="list"></div>

      <button class="btn-secondary" onclick="saveAllocation()">
        Save Allocation
      </button>

      <div id="allocMsg" class="notice"></div>
    </div>
  </div>

  <!-- EVALUATION -->
  <div class="section">
    <div class="section-header" onclick="toggle(this)">
      Student Evaluation
    </div>
    <div class="section-body">

      <label>Roll Number</label>
      <input id="evalRoll" placeholder="Enter roll number">

      <label>Evaluation Type</label>
      <select id="evalType">
        <option value="GD">Group Discussion</option>
        <option value="SEMINAR">Seminar</option>
        <option value="PI">Personal Interview</option>
      </select>

      <label>Positives</label>
      <textarea id="positives" rows="3" style="width:100%"></textarea>

      <label>Improvements</label>
      <textarea id="improvements" rows="3" style="width:100%"></textarea>

      <label>Marks (0–100)</label>
      <input type="number" id="marks" min="0" max="100">

      <button class="btn-primary" onclick="saveEvaluation()">
        Save Evaluation
      </button>

      <div id="evalMsg" class="notice"></div>
    </div>
  </div>

  <button class="btn-logout" onclick="logout()">Logout</button>

</div>

<footer>
  Developed by Dr. Rajesh Akula
  <div>© 2026 · Department of Mechanical Engineering, IIEST Shibpur</div>
</footer>

<script>
const BACKEND = "https://script.google.com/macros/s/AKfycbzs-V1FU-cXAWdCCgMrItFpdywUl0rsfj_Db1XhJBBP3mC7k8GUvDFclx2Ai0n4p-EbnQ/exec";

/* ---------- UI ---------- */
function toggle(el){
  el.parentElement.classList.toggle("open");
}

/* ---------- ALLOCATION ---------- */
function loadAllocationList(){
  const cat = allocCategory.value;
  const date = allocDate.value;
  allocList.innerHTML = "";
  allocMsg.innerText = "";

  if(!cat || !date) return;

  const action =
    cat==="GD" ? "getGDTopicStatus" :
    cat==="SEMINAR" ? "getSeminarStudentStatus" :
    "getPIStudentStatus";

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({action,date})
  })
  .then(r=>r.json())
  .then(res=>{
    res.students?.forEach(s=>{
      allocList.innerHTML += `
        <label>
          ${s.name} (${s.roll})
          <input type="checkbox" value="${s.roll}" ${s.checked?"checked":""}>
        </label>`;
    });

    res.topics?.forEach(t=>{
      allocList.innerHTML += `
        <label>
          Topic ${t.topic}
          <input type="checkbox" value="${t.topic}" ${t.checked?"checked":""}>
        </label>`;
    });
  });
}

function saveAllocation(){
  const date = allocDate.value;
  const cat  = allocCategory.value;
  const vals = [...allocList.querySelectorAll("input:checked")]
               .map(i=>i.value);

  if(!date || !cat || !vals.length){
    allocMsg.innerText = "Select date, category and at least one entry.";
    return;
  }

  const action = cat==="GD" ? "saveGDAllocation" : "saveIndividualAllocation";

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action,
      date,
      category:cat,
      topics:vals.join(","),
      rolls:vals.join(",")
    })
  })
  .then(r=>r.json())
  .then(()=>allocMsg.innerText="Allocation saved successfully.");
}

/* ---------- EVALUATION ---------- */
function saveEvaluation(){
  const roll = evalRoll.value.trim();
  if(!roll) return;

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"savePerformance",
      roll,
      type:evalType.value,
      positives:positives.value,
      improvements:improvements.value,
      marks:marks.value
    })
  })
  .then(r=>r.json())
  .then(()=>evalMsg.innerText="Evaluation saved successfully.");
}

/* ---------- LOGOUT ---------- */
function logout(){
  if(!confirm("Logout?")) return;
  location.href="faculty_login.html";
}
</script>

</body>
</html>
