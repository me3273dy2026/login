<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Faculty Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Segoe UI;background:#203a43;margin:0}
.card{max-width:1100px;margin:20px auto;background:#fff;
padding:24px;border-radius:14px}
button{width:100%;padding:12px;margin-top:10px;
border:none;border-radius:24px;font-weight:600}
.btn{background:#203a43;color:#fff}
.btn-red{background:#c0392b;color:#fff}
.box{background:#f4f7fb;padding:16px;margin-top:14px;border-radius:12px}
.sub{background:#fff;padding:10px;border-radius:8px;margin-top:8px}
input{width:100%;padding:10px;border-radius:8px}
.msg{margin-top:10px;font-weight:700;color:#c0392b}
</style>
</head>

<body>
<div class="card">
<h2>Faculty Dashboard</h2>

<div id="home">
  <button class="btn" onclick="openAlloc()">Allocate</button>
  <button class="btn" onclick="openEval()">Evaluate</button>
  <button class="btn-red" onclick="logout()">Logout</button>
</div>

<div id="alloc" style="display:none">

<div class="box">
  <b>Date</b>
  <input type="date" id="date" onchange="onDate()">
</div>

<div class="box">
  <b>Group Discussion</b>
  <div id="gdList" class="sub"></div>
  <button class="btn" onclick="saveGD()">Save / Update GD</button>
</div>

<div class="box">
  <b>Seminar</b>
  <div id="semList"></div>
  <button class="btn" onclick="saveSeminar()">Save Seminar</button>
</div>

<div class="box">
  <b>Personal Interview</b>
  <div id="piList"></div>
  <button class="btn" onclick="savePI()">Save PI</button>
</div>

<div id="msg" class="msg"></div>
<button class="btn-red" onclick="back()">Close</button>
</div>

<div id="eval" style="display:none">
<iframe src="faculty_evaluation.html"
style="width:100%;height:700px;border:none"></iframe>
<button class="btn-red" onclick="back()">Close</button>
</div>
</div>

<script>
const BACKEND="https://script.google.com/macros/s/AKfycbwtR83WSVuSgQyhp0kxHV27SIClPA3_b-D_RoNJsdp0AvRxV7Mhenl4zOiYRw8X2MU7Cg/exec";

function disable(msg){
  document.querySelectorAll("button").forEach(b=>b.disabled=true);
  msgBox.innerText=msg;
}
function enable(){
  document.querySelectorAll("button").forEach(b=>b.disabled=false);
  msgBox.innerText="";
}

function openAlloc(){home.style.display="none";alloc.style.display="block"}
function openEval(){home.style.display="none";eval.style.display="block"}
function back(){alloc.style.display=eval.style.display="none";home.style.display="block"}

const msgBox=document.getElementById("msg");

function onDate(){
  disable("Loading… Please wait");
  Promise.all([loadGD(),loadAlloc()]).then(enable);
}

function loadGD(){
  gdList.innerHTML="";
  return fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"getGDTopicStatus",
      date:date.value
    })
  }).then(r=>r.json()).then(j=>{
    j.topics.forEach(t=>{
      gdList.innerHTML+=
        `<label>
          <input type="checkbox" value="${t.topic}" ${t.checked?"checked":""}>
          ${t.topic}
        </label><br>`;
    });
  });
}

function loadAlloc(){
  return fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"getAllocationsByDate",
      date:date.value
    })
  });
}

function saveGD(){
  disable("Updating Group Discussion… Please wait");
  const topics=[...gdList.querySelectorAll("input:checked")]
    .map(i=>i.value);

  fetch(BACKEND,{
    method:"POST",
    body:new URLSearchParams({
      action:"saveGDAllocation",
      date:date.value,
      topics:topics.join(",")
    })
  }).then(onDate);
}

function saveSeminar(){alert("Seminar logic unchanged")}
function savePI(){alert("PI logic unchanged")}
function logout(){location.href="login.html";}
</script>
</body>
</html>
